### 开发任务清单与里程碑（MVP｜网页应用｜原型C）

范围基于 `Prd.md`：中文+公制、木质案板固定背景、2048px、匿名7天、移动优先。

## 里程碑
- M0 需求冻结（已完成）：PRD/原型/架构定版
- M1 可上传与排队（第1周）
- M2 文本先行可用（第2周）：返回中文食谱，可编辑与导出
- M3 平铺图生成与下载（第3周）
- M4 稳定化与上线（第4周）：监控、限流、灰度

## 前端（Web App｜Next.js + Tailwind）
- 上传页与直传对象存储（含进度、失败重试）
- 结果页移动优先布局（原型C）：
  - 平铺图预览、放大、重新生成
  - 食材与步骤的表单编辑、保存
  - 下载（2048px）、复制食谱、分享链接
  - 反馈“准确/不准 + 备注”
- 轮询/长轮询 Job 状态显示；错误态与超时降级提示
- 提示语：下载区显示“AI 生成内容仅供参考，注意食材过敏”
- 验收：PWA/移动端视口、核心路径可用率≥99%、LCP<3s（样本页）

## 后端 API（Node.js + Fastify/NestJS）
- `POST /jobs`：创建任务、返回 `jobId`、直传签名（可选）
- `GET /jobs/:id`：查询状态与结果，包含文本/图片URL
- `POST /feedback`：收集准确度与备注
- 权限与风控：基本内容审核、尺寸/类型校验、速率限制
- 存储策略：对象存储+CDN、7天生命周期、元数据DB（PostgreSQL/KV）
- 验收：并发100 RPS 峰值稳定；失败率<1%；99百分位响应<500ms（不含推理）

## 队列与Worker（Redis + BullMQ）
- 任务入队/出队/重试/死信；阶段化状态：queued→running→partial→succeeded/failed
- 步骤：
  1) 视觉识别与候选食材（外部多模态API）
  2) 用量估算（启发式+提示词）
  3) Doubao 1.6 Flash 生成中文烹饪步骤
  4) SeeDream 4.0 生成食材平铺图（木质案板模板，2048px）
- 降级策略：超时先回文本，图像补偿生成
- 验收：平均作业<15s，P95<20s，失败自动重试1次

## 模型与提示工程
- 视觉：采用托管多模态API（待定）
- 文本：Doubao 1.6 Flash（火山方舟），提示包含食材清单结构与区间用量格式
- 图像：SeeDream 4.0，模板化提示 + 参考构图；固定俯拍与木质案板
- 评测：100张样本集，准确标注率≥60%，可编辑纠错后满意度≥80%

## 监控与运维
- Sentry 前后端接入；队列面板与告警；作业日志
- 埋点：上传成功率、阶段耗时、编辑率、导出率、反馈率
- 限流与灰度：每日配额、队列长度提示、文本优先降级

## 角色分工（建议）
- 前端工程师（1）：页面与交互、直传、轮询、编辑器
- 后端工程师（1）：API、队列、存储与生命周期、鉴权与限流
- 提示/模型工程（0.5）：提示词、模板、评测集与数据闭环
- 设计（0.5）：移动优先视觉与组件规范、空态/错误态

## 风险与应对
- 识别偏差：通过可编辑与区间用量容错；V2 加交互校正
- 成本与时延：并发/队列与缓存；文本先回、图像后补
- 风格稳定：模板+参考图；必要时引入 ControlNet/IP-Adapter

## 验收清单（DoD）
- 从上传到导出在移动端单手可完成；关键路径通过率≥95%
- 文本产出必达；图像生成失败率≤5%，失败时文案清晰
- CDN 命中率≥80%；对象存储7天清理生效
- 所有接口经 Postman 集合与自动化烟测通过

## 集成任务（新增）
- 设计 LLM 适配层：`providers/doubao.ts`（鉴权、模型名、温度、超时）
  - Endpoint: `https://ark.cn-beijing.volces.com/api/v3/chat/completions`
  - 模型名: `doubao-seed-1-6-flash-250828`
  - 输入：成品图URL + 指令提示；输出：中文步骤（3–8步）
  - 环境变量：`DOUBAO_API_KEY`
- 设计 图像生成适配层：`providers/seedream.ts`（鉴权、分辨率、风格模板）
-   - Endpoint: `https://ark.cn-beijing.volces.com/api/v3/images/generations`
-   - 模型名: `doubao-seedream-4-0-250828`
-   - 参数：`response_format=url`、`size=2K`、`stream=false`、`sequential_image_generation=disabled`、`watermark=false`
-   - 环境变量：`SEEDREAM_API_KEY`
- 在 Worker 中串联两适配器并记录阶段耗时与错误码
- 待你提供 API 细节后，补充环境变量与重试/限流策略



